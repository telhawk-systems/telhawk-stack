# OCSF Coverage Analysis

## Current State

### Event Classes (Generated by ocsf-generator)

**Total**: 77 OCSF event class structs fully generated

**Categories**:
- Application (8 classes)
- Discovery (24 classes)
- Findings (9 classes)
- IAM (6 classes)
- Network (14 classes)
- Remediation (4 classes)
- System (10 classes)
- Unmanned Systems (2 classes)

✅ **All OCSF event structures are available** - ready to use

### Normalizers (Generated by normalizer-generator)

**Total**: 7 normalizers with source type patterns

**Currently Implemented**:
1. Authentication (IAM 3002)
2. Network Activity (Network 4001)
3. Process Activity (System 1007)
4. File Activity (System 1001)
5. DNS Activity (Network 4003)
6. HTTP Activity (Network 4002)
7. Detection Finding (Findings 2004)

**Gap**: 70 OCSF classes without normalizers

## Why the Gap?

The normalizer generator is **pattern-based**, not **schema-based**:

```
ocsf-generator:
  Input: OCSF schema JSON files
  Output: Go structs for ALL classes
  Approach: Automatic, schema-driven

normalizer-generator:
  Input: sourcetype_patterns.json (manually defined)
  Output: Normalizers for defined patterns only
  Approach: Manual pattern definition required
```

## Two Paths Forward

### Option A: Manual Pattern Addition (Current Approach)

Add patterns to `sourcetype_patterns.json` as needed:

```json
{
  "patterns": {
    "email_activity": {
      "class_uid": 4009,
      "category": "network",
      "sourcetype_patterns": ["^email", "^smtp", "^exchange"]
    },
    "vulnerability_finding": {
      "class_uid": 2001,
      "category": "findings",
      "sourcetype_patterns": ["^vuln", "^cve", "^scan"]
    }
    // ... add 68 more
  }
}
```

**Pros**: Targeted, only generate what we need
**Cons**: Manual work, might miss useful classes

### Option B: Auto-Generate from Schema (Recommended)

Enhance normalizer-generator to work like ocsf-generator:

1. Read OCSF schema directly
2. For each event class:
   - Generate normalizer automatically
   - Use class name as default source type pattern
   - Include generic field mapping
   - Support common field variants

```go
// Generated automatically for ALL 77 classes
func NewEmailActivityNormalizer() *EmailActivityNormalizer {
    // Auto-generated with sensible defaults
}
```

**Pros**: Complete coverage, consistent, maintainable
**Cons**: Initial generator work (but reusable)

## Recommendation

**Enhance normalizer-generator to be schema-driven**:

1. Read `ocsf-schema/events/` directory
2. For each `*.json` file, generate a normalizer
3. Use common field mapping for all classes
4. Allow pattern overrides via `sourcetype_patterns.json`

This gives us:
- ✅ Complete OCSF coverage (77 normalizers)
- ✅ Automatic updates when schema changes
- ✅ Consistent approach with ocsf-generator
- ✅ Custom patterns when needed

## Impact

**Current**:
```
Event Classes: 77 ✅ (100% coverage)
Normalizers:    7 ⚠️  (9% coverage)
```

**After Enhancement**:
```
Event Classes: 77 ✅ (100% coverage)
Normalizers:   77 ✅ (100% coverage)
```

## Next Steps

1. Update `tools/normalizer-generator/main.go` to:
   - Read OCSF schema like `ocsf-generator` does
   - Generate normalizer for every event class
   - Use pattern file as overrides, not requirements

2. Regenerate normalizers:
   ```bash
   cd tools/normalizer-generator
   go run main.go -v
   ```

3. Update core/cmd/core/main.go to register all normalizers

4. Update docs to reflect 100% coverage

## Related

- `tools/ocsf-generator/` - Schema-driven event class generation
- `tools/normalizer-generator/sourcetype_patterns.json` - 7 pattern definitionss
